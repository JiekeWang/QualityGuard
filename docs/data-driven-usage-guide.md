# æ•°æ®é©±åŠ¨æµ‹è¯• - ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½å…¥å£

### 1. æµ‹è¯•ç”¨ä¾‹é¡µé¢å…¥å£

**è·¯å¾„**ï¼šæµ‹è¯•ç”¨ä¾‹ â†’ æ–°å»º/ç¼–è¾‘ç”¨ä¾‹ â†’ "ç”¨ä¾‹ç±»å‹" Tab â†’ å¯ç”¨"æ•°æ®é©±åŠ¨"

**æ“ä½œæ­¥éª¤**ï¼š
1. è¿›å…¥"æµ‹è¯•ç”¨ä¾‹"é¡µé¢
2. ç‚¹å‡»"æ–°å»ºç”¨ä¾‹"æˆ–ç¼–è¾‘ç°æœ‰ç”¨ä¾‹
3. åœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œåˆ‡æ¢åˆ°"ç”¨ä¾‹ç±»å‹"æ ‡ç­¾é¡µ
4. æ‰¾åˆ°"æ•°æ®é©±åŠ¨"ä¸‹æ‹‰æ¡†ï¼Œé€‰æ‹©"æ˜¯"
5. ä¿å­˜åï¼Œä¼šå‡ºç°"æ•°æ®é©±åŠ¨é…ç½®"æ ‡ç­¾é¡µ

### 2. æ•°æ®é©±åŠ¨é…ç½®Tab

å¯ç”¨æ•°æ®é©±åŠ¨åï¼Œè¡¨å•ä¸­ä¼šæ˜¾ç¤º"æ•°æ®é©±åŠ¨é…ç½®"Tabï¼Œè¿™æ˜¯ä¸»è¦çš„æ“ä½œå…¥å£ã€‚

**ä½ç½®**ï¼šæµ‹è¯•ç”¨ä¾‹è¡¨å• â†’ "æ•°æ®é©±åŠ¨é…ç½®" Tab

**åŒ…å«åŠŸèƒ½**ï¼š
- æ·»åŠ æ•°æ®è¡Œ
- å¯¼å‡ºJSON
- å¯¼å…¥JSON
- **å¯¼å…¥CSV/Excel**ï¼ˆæ–°åŠŸèƒ½ï¼‰
- æ•°æ®è¡¨æ ¼ï¼ˆæ˜¾ç¤ºå’Œç¼–è¾‘ï¼‰

## ä½¿ç”¨æµç¨‹

### æ–¹å¼1ï¼šæ‰‹åŠ¨æ·»åŠ æ•°æ®ï¼ˆé€‚åˆå°‘é‡æ•°æ®ï¼‰

#### æ­¥éª¤1ï¼šåˆ›å»ºæµ‹è¯•ç”¨ä¾‹
1. ç‚¹å‡»"æ–°å»ºç”¨ä¾‹"
2. å¡«å†™åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€é¡¹ç›®ã€ç±»å‹ç­‰ï¼‰
3. åœ¨"ç”¨ä¾‹ç±»å‹"Tabä¸­ï¼Œå°†"æ•°æ®é©±åŠ¨"è®¾ç½®ä¸º"æ˜¯"

#### æ­¥éª¤2ï¼šé…ç½®è¯·æ±‚æ¨¡æ¿
åˆ‡æ¢åˆ°"è¯·æ±‚é…ç½®"Tabï¼Œé…ç½®è¯·æ±‚å‚æ•°æ¨¡æ¿ï¼š

```json
{
  "method": "POST",
  "path": "/api/v1/login",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": {
    "username": "${username}",
    "password": "${password}",
    "device_id": "default_device"
  }
}
```

**è¯´æ˜**ï¼š
- ä½¿ç”¨ `${å˜é‡å}` æ ‡è®°éœ€è¦æ›¿æ¢çš„å­—æ®µ
- å›ºå®šå­—æ®µç›´æ¥å†™æ­»ï¼ˆå¦‚ `device_id`ï¼‰

#### æ­¥éª¤3ï¼šæ·»åŠ æµ‹è¯•æ•°æ®
åˆ‡æ¢åˆ°"æ•°æ®é©±åŠ¨é…ç½®"Tabï¼š

1. ç‚¹å‡»"æ·»åŠ æ•°æ®è¡Œ"æŒ‰é’®
2. åœ¨"æ¥å£å…¥å‚"åˆ—å¡«å†™ï¼š
   ```json
   {
     "username": "user1",
     "password": "pass1"
   }
   ```
3. åœ¨"æ–­è¨€"åˆ—å¡«å†™ï¼š
   ```json
   [
     {"type": "status_code", "expected": 200},
     {"type": "response_body", "path": "$.data.user_id", "operator": "equal", "expected": 1001}
   ]
   ```
4. ç‚¹å‡»"ä¿å­˜"

#### æ­¥éª¤4ï¼šæ‰§è¡Œæµ‹è¯•
1. ä¿å­˜æµ‹è¯•ç”¨ä¾‹
2. åœ¨æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®
3. é€‰æ‹©ç¯å¢ƒ
4. æŸ¥çœ‹æ‰§è¡Œç»“æœ

### æ–¹å¼2ï¼šCSV/Excelå¯¼å…¥ï¼ˆæ¨èï¼Œé€‚åˆå¤§é‡æ•°æ®ï¼‰

#### æ­¥éª¤1ï¼šå‡†å¤‡CSVæ–‡ä»¶

åˆ›å»ºä¸€ä¸ªCSVæ–‡ä»¶ï¼Œä¾‹å¦‚ `login_test_data.csv`ï¼š

```csv
username,password,expected_status,expected_user_id,expected_username
user1,pass1,200,1001,user1
user2,pass2,200,1002,user2
user3,pass3,401,0,
```

**å­—æ®µè¯´æ˜**ï¼š
- `username`, `password` - ä¼šæ›¿æ¢æ¨¡æ¿ä¸­çš„ `${username}` å’Œ `${password}`
- `expected_status` - è‡ªåŠ¨ç”ŸæˆçŠ¶æ€ç æ–­è¨€
- `expected_user_id` - è‡ªåŠ¨ç”Ÿæˆ `$.data.user_id` çš„æ–­è¨€
- `expected_username` - è‡ªåŠ¨ç”Ÿæˆ `$.data.username` çš„æ–­è¨€

> ğŸ’¡ **è¯¦ç»†çš„æ–­è¨€é…ç½®è¯´æ˜**ï¼šæ”¯æŒæ·±å±‚åµŒå¥—è·¯å¾„ã€æ•°ç»„ç´¢å¼•ã€å¤šç§æ“ä½œç¬¦ï¼Œè¯·å‚è€ƒï¼š
> ğŸ“– [Excel æ–­è¨€é…ç½®å®Œæ•´æŒ‡å—](./assertion-excel-format-guide.md)

#### æ­¥éª¤2ï¼šé…ç½®æµ‹è¯•ç”¨ä¾‹

1. åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼Œå¯ç”¨æ•°æ®é©±åŠ¨
2. é…ç½®è¯·æ±‚æ¨¡æ¿ï¼ˆåŒæ–¹å¼1ï¼‰
3. **ä¸éœ€è¦é…ç½®æ–­è¨€**ï¼ˆä¼šè‡ªåŠ¨ä»expected_*å­—æ®µç”Ÿæˆï¼‰

#### æ­¥éª¤3ï¼šå¯¼å…¥CSVæ–‡ä»¶

1. åˆ‡æ¢åˆ°"æ•°æ®é©±åŠ¨é…ç½®"Tab
2. ç‚¹å‡»"å¯¼å…¥CSV/Excel"æŒ‰é’®
3. é€‰æ‹©å‡†å¤‡å¥½çš„CSVæ–‡ä»¶
4. ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå¹¶æ˜¾ç¤ºåœ¨è¡¨æ ¼ä¸­
5. æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®
6. ç‚¹å‡»"ä¿å­˜"

#### æ­¥éª¤4ï¼šæ‰§è¡Œæµ‹è¯•

1. ä¿å­˜æµ‹è¯•ç”¨ä¾‹
2. ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®
3. **è‡ªåŠ¨å¹¶å‘æ‰§è¡Œ**ï¼ˆæ•°æ®é‡>10æ—¶ï¼‰
4. å®æ—¶æŸ¥çœ‹è¿›åº¦å’Œç»“æœ

## é«˜çº§åŠŸèƒ½

### 1. æ•°ç»„å­—æ®µæ”¯æŒ

#### æ–¹å¼Aï¼šåˆ†éš”ç¬¦æ ¼å¼ï¼ˆæ¨èï¼‰

CSVæ–‡ä»¶ï¼š
```csv
user_ids,tags,expected_status
1,2,3,tag1,tag2,200
4,5,tag3,200
```

ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æä¸ºï¼š
```json
{
  "user_ids": [1, 2, 3],
  "tags": ["tag1", "tag2"]
}
```

#### æ–¹å¼Bï¼šå­—æ®µåç¼€æ ¼å¼

CSVæ–‡ä»¶ï¼š
```csv
user_ids_1,user_ids_2,user_ids_3,tags_1,tags_2,expected_status
1,2,3,tag1,tag2,200
4,5,,tag3,,200
```

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆå¹¶ä¸ºæ•°ç»„ï¼š
```json
{
  "user_ids": [1, 2, 3],
  "tags": ["tag1", "tag2"]
}
```

### 2. èŠ‚ç‚¹æ–­è¨€

CSVæ–‡ä»¶ï¼š
```csv
username,password,expected_status,expected_node_data
user1,pass1,200,"{""user_id"":1001,""username"":""user1"",""email"":""user1@test.com""}"
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆèŠ‚ç‚¹æ–­è¨€ï¼š
```json
{
  "type": "node",
  "path": "$.data",
  "mode": "all_fields",
  "expected": {
    "user_id": 1001,
    "username": "user1",
    "email": "user1@test.com"
  }
}
```

**ä¼˜åŠ¿**ï¼šä¸€æ¬¡æ–­è¨€èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­—æ®µï¼Œæ— éœ€é€ä¸ªé…ç½®ã€‚

### 3. JSONPathè‡ªåŠ¨æ¨æ–­

ç³»ç»Ÿä¼šè‡ªåŠ¨æ¨æ–­å­—æ®µçš„JSONPathè·¯å¾„ï¼š

| CSVåˆ—å | æ¨æ–­çš„JSONPath | è¯´æ˜ |
|---------|---------------|------|
| `expected_status` | - | çŠ¶æ€ç æ–­è¨€ |
| `expected_user_id` | `$.data.user_id` | é»˜è®¤åœ¨$.dataä¸‹ |
| `expected_code` | `$.code` | é¡¶å±‚å­—æ®µ |
| `expected_data_name` | `$.data.name` | ä¸‹åˆ’çº¿è¡¨ç¤ºåµŒå¥— |
| `expected_items_0_id` | `$.items[0].id` | æ•°ç»„ç´¢å¼• |

### 4. è‡ªåŠ¨ç±»å‹è½¬æ¢

ç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹ï¼š

| CSVå€¼ | è½¬æ¢åç±»å‹ | ç¤ºä¾‹ |
|-------|-----------|------|
| `200` | æ•´æ•° | `200` |
| `3.14` | æµ®ç‚¹æ•° | `3.14` |
| `true` | å¸ƒå°”å€¼ | `true` |
| `false` | å¸ƒå°”å€¼ | `false` |
| `null` | null | `null` |
| `user1` | å­—ç¬¦ä¸² | `"user1"` |

## æ‰§è¡Œæ¨¡å¼

### ä¸²è¡Œæ‰§è¡Œï¼ˆæ•°æ®é‡ â‰¤ 10ï¼‰

- é€æ¡æ‰§è¡Œ
- é€‚åˆå°‘é‡æ•°æ®
- æ‰§è¡Œæ—¶é—´ï¼šæ•°æ®é‡ Ã— å¹³å‡å“åº”æ—¶é—´

### å¹¶å‘æ‰§è¡Œï¼ˆæ•°æ®é‡ > 10ï¼‰

- **è‡ªåŠ¨å¯ç”¨**
- å¹¶å‘æ•°ï¼š20ï¼ˆå¯è°ƒæ•´ï¼‰
- é€‚åˆå¤§é‡æ•°æ®
- **æ€§èƒ½æå‡ï¼š10-20å€**
- æ‰§è¡Œæ—¶é—´ï¼šæ•°æ®é‡ Ã· å¹¶å‘æ•° Ã— å¹³å‡å“åº”æ—¶é—´

**ç¤ºä¾‹**ï¼š
- 1000æ¡æ•°æ®ï¼Œå¹³å‡å“åº”æ—¶é—´1ç§’
- ä¸²è¡Œæ‰§è¡Œï¼šçº¦1000ç§’ï¼ˆ16åˆ†é’Ÿï¼‰
- å¹¶å‘æ‰§è¡Œï¼šçº¦50ç§’ï¼ˆ1åˆ†é’Ÿï¼‰
- **èŠ‚çœæ—¶é—´ï¼š15åˆ†é’Ÿ**

## å¯¹æ¥è¯´æ˜

### ä¸æµ‹è¯•ç”¨ä¾‹çš„å¯¹æ¥æµç¨‹

```
æµ‹è¯•ç”¨ä¾‹åˆ›å»º
    â†“
å¯ç”¨æ•°æ®é©±åŠ¨ï¼ˆis_data_driven=trueï¼‰
    â†“
é…ç½®è¯·æ±‚æ¨¡æ¿ï¼ˆåŒ…å«${å˜é‡}ï¼‰
    â†“
å¯¼å…¥CSV/Excel æˆ– æ‰‹åŠ¨æ·»åŠ æ•°æ®
    â†“
ç³»ç»Ÿè‡ªåŠ¨ï¼š
  - è§£æCSVæ•°æ®
  - ç”Ÿæˆæ–­è¨€ï¼ˆä»expected_*å­—æ®µï¼‰
  - ä¿å­˜åˆ°data_driverå­—æ®µ
    â†“
æ‰§è¡Œæµ‹è¯•
    â†“
ç³»ç»Ÿè‡ªåŠ¨ï¼š
  - è¯»å–data_driveræ•°æ®
  - å¾ªç¯æ¯è¡Œæ•°æ®
  - æ›¿æ¢æ¨¡æ¿å˜é‡
  - åº”ç”¨æ–­è¨€
  - å¹¶å‘æ‰§è¡Œï¼ˆæ•°æ®é‡>10ï¼‰
  - è®°å½•ç»“æœ
    â†“
æŸ¥çœ‹æ‰§è¡Œç»“æœ
```

### æ•°æ®å­˜å‚¨ä½ç½®

æ•°æ®å­˜å‚¨åœ¨æµ‹è¯•ç”¨ä¾‹çš„ `config` å­—æ®µä¸­ï¼š

```json
{
  "method": "POST",
  "path": "/api/v1/login",
  "body": {...},
  "data_driver": {
    "data": [
      {
        "username": "user1",
        "password": "pass1",
        "expected_status": 200,
        "expected_user_id": 1001
      },
      ...
    ],
    "metadata": {
      "total_rows": 100,
      "imported_at": "2024-12-18T20:00:00Z",
      "format": "csv"
    }
  }
}
```

### APIæ¥å£å¯¹æ¥

#### å¯¼å…¥æ¥å£ï¼ˆå¯é€‰ï¼Œå‰ç«¯å·²å®ç°ç®€åŒ–ç‰ˆï¼‰

```
POST /api/v1/test-cases/{case_id}/data-driver/import
Content-Type: multipart/form-data

Parameters:
  - file: CSV/Excelæ–‡ä»¶
  - preview: true/falseï¼ˆæ˜¯å¦ä»…é¢„è§ˆï¼‰

Response:
  {
    "success": true,
    "data": [...],
    "summary": {
      "total_rows": 100,
      "valid_rows": 98,
      "invalid_rows": 2
    }
  }
```

## å¸¸è§åœºæ™¯

### åœºæ™¯1ï¼šç™»å½•æ¥å£æµ‹è¯•ï¼ˆä¸åŒç”¨æˆ·ï¼‰

**è¯·æ±‚æ¨¡æ¿**ï¼š
```json
{
  "method": "POST",
  "path": "/api/v1/login",
  "body": {
    "username": "${username}",
    "password": "${password}"
  }
}
```

**CSVæ•°æ®**ï¼š
```csv
username,password,expected_status,expected_user_id
admin,admin123,200,1
user1,pass1,200,1001
user2,pass2,200,1002
guest,guest123,200,2000
invalid,wrong,401,0
```

### åœºæ™¯2ï¼šæ‰¹é‡åˆ›å»ºç”¨æˆ·

**è¯·æ±‚æ¨¡æ¿**ï¼š
```json
{
  "method": "POST",
  "path": "/api/v1/users",
  "body": {
    "username": "${username}",
    "email": "${email}",
    "role": "${role}",
    "status": "active"
  }
}
```

**CSVæ•°æ®**ï¼š
```csv
username,email,role,expected_status,expected_user_id
user1,user1@test.com,admin,200,1001
user2,user2@test.com,user,200,1002
user3,user3@test.com,guest,200,1003
```

### åœºæ™¯3ï¼šæ‰¹é‡æŸ¥è¯¢ï¼ˆä½¿ç”¨è·¯å¾„å˜é‡ï¼‰

**è¯·æ±‚æ¨¡æ¿**ï¼š
```json
{
  "method": "GET",
  "path": "/api/v1/users/${user_id}"
}
```

**CSVæ•°æ®**ï¼š
```csv
user_id,expected_status,expected_username,expected_email
1001,200,user1,user1@test.com
1002,200,user2,user2@test.com
1003,200,user3,user3@test.com
9999,404,,
```

## æ³¨æ„äº‹é¡¹

### 1. CSVæ ¼å¼è¦æ±‚
- ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯æ ‡é¢˜è¡Œï¼ˆåˆ—åï¼‰
- ä½¿ç”¨é€—å·åˆ†éš”
- ç¼–ç ï¼šUTF-8æˆ–GBK
- ä¸è¦åŒ…å«ä¸­æ–‡é€—å·

### 2. å˜é‡å‘½åè§„åˆ™
- åªæ”¯æŒå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- å¤§å°å†™æ•æ„Ÿ
- ä¸è¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦

### 3. æ–­è¨€å­—æ®µå‘½å
- ä»¥ `expected_` å¼€å¤´
- `expected_status` - çŠ¶æ€ç 
- `expected_node_*` - èŠ‚ç‚¹æ–­è¨€
- å…¶ä»– - JSONPathæ–­è¨€

### 4. æ•°ç»„å­—æ®µ
- åˆ†éš”ç¬¦é»˜è®¤ä¸ºé€—å·
- å­—æ®µåç¼€æ ¼å¼ï¼š`field_1`, `field_2`, ...
- JSONæ ¼å¼éœ€è¦è½¬ä¹‰å¼•å·

### 5. æ€§èƒ½å»ºè®®
- å°‘é‡æ•°æ®ï¼ˆ<10æ¡ï¼‰ï¼šæ‰‹åŠ¨æ·»åŠ 
- ä¸­é‡æ•°æ®ï¼ˆ10-100æ¡ï¼‰ï¼šCSVå¯¼å…¥
- å¤§é‡æ•°æ®ï¼ˆ>100æ¡ï¼‰ï¼šCSVå¯¼å…¥ + å¹¶å‘æ‰§è¡Œ

## å¿«é€Ÿå¼€å§‹

### 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

1. **åˆ›å»ºæµ‹è¯•ç”¨ä¾‹**
   - åç§°ï¼šç™»å½•æ¥å£æµ‹è¯•
   - ç±»å‹ï¼šAPI
   - æ•°æ®é©±åŠ¨ï¼šæ˜¯

2. **é…ç½®è¯·æ±‚æ¨¡æ¿**
   ```json
   {
     "method": "POST",
     "path": "/api/v1/login",
     "body": {
       "username": "${username}",
       "password": "${password}"
     }
   }
   ```

3. **åˆ›å»ºCSVæ–‡ä»¶**ï¼ˆlogin.csvï¼‰
   ```csv
   username,password,expected_status
   user1,pass1,200
   user2,pass2,200
   ```

4. **å¯¼å…¥CSV**
   - æ•°æ®é©±åŠ¨é…ç½® â†’ å¯¼å…¥CSV/Excel
   - é€‰æ‹© login.csv

5. **æ‰§è¡Œæµ‹è¯•**
   - ç‚¹å‡»æ‰§è¡ŒæŒ‰é’®
   - æŸ¥çœ‹ç»“æœ

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå˜é‡æ²¡æœ‰è¢«æ›¿æ¢
- **åŸå› **ï¼šå˜é‡åæ‹¼å†™é”™è¯¯æˆ–CSVåˆ—åä¸åŒ¹é…
- **è§£å†³**ï¼šæ£€æŸ¥ `${å˜é‡å}` å’ŒCSVåˆ—åæ˜¯å¦ä¸€è‡´

### é—®é¢˜2ï¼šæ–­è¨€æ²¡æœ‰ç”Ÿæˆ
- **åŸå› **ï¼šCSVåˆ—åæ²¡æœ‰ `expected_` å‰ç¼€
- **è§£å†³**ï¼šç¡®ä¿æ–­è¨€å­—æ®µä»¥ `expected_` å¼€å¤´

### é—®é¢˜3ï¼šæ•°ç»„å­—æ®µæ²¡æœ‰è§£æ
- **åŸå› **ï¼šå­—æ®µå€¼æ ¼å¼ä¸æ­£ç¡®
- **è§£å†³**ï¼šä½¿ç”¨åˆ†éš”ç¬¦ï¼ˆ1,2,3ï¼‰æˆ–å­—æ®µåç¼€ï¼ˆfield_1, field_2ï¼‰

### é—®é¢˜4ï¼šå¹¶å‘æ‰§è¡Œæ²¡æœ‰å¯ç”¨
- **åŸå› **ï¼šæ•°æ®é‡ â‰¤ 10
- **è§£å†³**ï¼šå¢åŠ æµ‹è¯•æ•°æ®åˆ°10æ¡ä»¥ä¸Š

## æ€»ç»“

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
1. âœ… **ç®€å•æ˜“ç”¨** - åªéœ€å‡†å¤‡CSVæ–‡ä»¶
2. âœ… **è‡ªåŠ¨ç”Ÿæˆæ–­è¨€** - expected_* å­—æ®µè‡ªåŠ¨è½¬æ¢
3. âœ… **å¹¶å‘æ‰§è¡Œ** - å¤§æ•°æ®é‡è‡ªåŠ¨å¹¶å‘ï¼Œ10-20å€æ€§èƒ½æå‡
4. âœ… **çµæ´»å¼ºå¤§** - æ”¯æŒæ•°ç»„ã€èŠ‚ç‚¹æ–­è¨€ã€ç±»å‹è½¬æ¢

**é€‚ç”¨åœºæ™¯**ï¼š
- åŒä¸€æ¥å£ï¼Œä¸åŒå‚æ•°
- æ‰¹é‡æ•°æ®éªŒè¯
- å›å½’æµ‹è¯•
- å‹åŠ›æµ‹è¯•ï¼ˆç»“åˆå¹¶å‘ï¼‰

**å¼€å§‹ä½¿ç”¨**ï¼š
æµ‹è¯•ç”¨ä¾‹ â†’ å¯ç”¨æ•°æ®é©±åŠ¨ â†’ å¯¼å…¥CSV â†’ æ‰§è¡Œæµ‹è¯•

